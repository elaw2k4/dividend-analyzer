<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dividend Projection Tool</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f0f0f0; }
    input { margin: 5px 0; }
  </style>
</head>
<body>

  <h2>Dividend Yield Analyzer</h2>
  <input type="file" id="fileInput" />
  <br><br>
  <label>Investment Amount: $<input type="number" id="investment" value="100000"></label><br>
  <label>Projection Years: <input type="number" id="years" value="10"></label><br>
  <label>Top N Stocks to Show: <input type="number" id="topN" value="10"></label><br>
  <button onclick="analyze()">Analyze</button>

  <div id="output"></div>

  <script>
  let sheetData = [];

  document.getElementById('fileInput').addEventListener('change', function (e) {
    const reader = new FileReader();
    reader.onload = function (e) {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type: 'array' });
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      sheetData = XLSX.utils.sheet_to_json(worksheet);
    };
    reader.readAsArrayBuffer(e.target.files[0]);
  });

  function analyze() {
    const investment = parseFloat(document.getElementById('investment').value);
    const years = parseInt(document.getElementById('years').value);
    const topN = parseInt(document.getElementById('topN').value);

    const resultsCompounded = [];
    const resultsGrowingNoReinvest = [];

    for (let row of sheetData) {
      const name = row['Name'];
      const ticker = row['Ticker'];
      const divYield = parseFloat(row['Div Yield']);
      const cagr = parseFloat(row['3Y Div CAGR']);

      if (isNaN(divYield) || isNaN(cagr)) continue;

      // Compounded: reinvested yields grow total payout
      let totalCompounded = 0;
      let futureYield = divYield;
      const yearlyCompounded = [];

      for (let y = 1; y <= years; y++) {
        const currentYield = divYield * Math.pow(1 + cagr / 100, y);
        const annualDividend = investment * currentYield / 100;
        totalCompounded += annualDividend;
        yearlyCompounded.push(annualDividend.toFixed(2));
        if (y === years) futureYield = currentYield;
      }

      resultsCompounded.push({
        name,
        ticker,
        futureYield: futureYield.toFixed(2),
        totalDividends: totalCompounded.toFixed(2),
        yearlyDividends: yearlyCompounded,
      });

      // Growing No Reinvest: yield increases, dividends withdrawn each year
      let totalNoReinvest = 0;
      const yearlyNoReinvest = [];

      for (let y = 1; y <= years; y++) {
        const currentYield = divYield * Math.pow(1 + cagr / 100, y);
        const annualDividend = investment * currentYield / 100;
        totalNoReinvest += annualDividend;
        yearlyNoReinvest.push(annualDividend.toFixed(2));
      }

      resultsGrowingNoReinvest.push({
        name,
        ticker,
        startYield: divYield.toFixed(2),
        endYield: (divYield * Math.pow(1 + cagr / 100, years)).toFixed(2),
        totalDividends: totalNoReinvest.toFixed(2),
        yearlyDividends: yearlyNoReinvest,
      });
    }

    // Sort both lists by total dividends
    resultsCompounded.sort((a, b) => b.totalDividends - a.totalDividends);
    resultsGrowingNoReinvest.sort((a, b) => b.totalDividends - a.totalDividends);

    const topCompounded = resultsCompounded.slice(0, topN);
    const topNoReinvest = resultsGrowingNoReinvest.slice(0, topN);

    const createTable = (data, type, useEndYield) => {
      let html = `<h3>${type} Projection</h3><table>
        <tr>
          <th>Ticker</th>
          <th>Name</th>
          <th>${useEndYield ? 'Start Yield (%)' : 'Future Yield (%)'}</th>
          ${useEndYield ? '<th>End Yield (%)</th>' : ''}
          <th>Total Dividends ($)</th>
          ${Array.from({ length: years }, (_, i) => `<th>Year ${i + 1}</th>`).join('')}
        </tr>`;

      for (let stock of data) {
        html += `<tr>
          <td>${stock.ticker}</td>
          <td>${stock.name}</td>
          <td>${useEndYield ? stock.startYield : stock.futureYield}</td>
          ${useEndYield ? `<td>${stock.endYield}</td>` : ''}
          <td>${stock.totalDividends}</td>
          ${stock.yearlyDividends.map(val => `<td>${val}</td>`).join('')}
        </tr>`;
      }

      html += `</table>`;
      return html;
    };

    document.getElementById('output').innerHTML =
      createTable(topCompounded, 'Compounded Reinvested Dividends', false) +
      '<br>' +
      createTable(topNoReinvest, 'Growing Dividends (No Reinvestment)', true);
  }
</script>

</body>
</html>
